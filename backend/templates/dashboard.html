<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Smart Garbage Dashboard</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    body { background: #f8f9fa; }
    #map { height: 400px; border-radius: 10px; margin-bottom: 20px; }
    th { background: #343a40; color: white; }
    img { border-radius: 5px; }
  </style>
</head>
<body class="p-4">

  <div class="container">
    <h2 class="mb-4 text-center">üóëÔ∏è Smart Garbage Detection Dashboard</h2>

    <!-- Map -->
    <div id="map"></div>

    <!-- Table -->
    <table class="table table-bordered table-hover">
      <thead class="table-dark">
        <tr>
          <th>ID</th>
          <th>Type</th>
          <th>Confidence</th>
          <th>Status</th>
          <th>Latitude</th>
          <th>Longitude</th>
          <th>Image</th>
          <th>Timestamp</th>
        </tr>
      </thead>
      <tbody id="table-body"></tbody>
    </table>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    async function loadData() {
      const response = await fetch('/data');
      const detections = await response.json();
      const tbody = document.getElementById('table-body');
      tbody.innerHTML = '';

      detections.forEach(d => {
        const [id, type, confidence, status, lat, lon, img, timestamp] = d;
        const row = `
          <tr>
            <td>${id}</td>
            <td>${type}</td>
            <td>${confidence.toFixed(2)}</td>
            <td>${status}</td>
            <td>${lat}</td>
            <td>${lon}</td>
            <td>${img ? `<img src="/static/detections/${img}" width="80">` : 'N/A'}</td>
            <td>${timestamp}</td>
          </tr>`;
        tbody.insertAdjacentHTML('beforeend', row);
      });

      // Update map
      const map = L.map('map').setView([28.6139, 77.2090], 12);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
      }).addTo(map);

      detections.forEach(d => {
        const [id, type, confidence, status, lat, lon, img, timestamp] = d;
        if (lat && lon) {
          const popupHtml = `
            <b>ID:</b> ${id}<br>
            <b>Type:</b> ${type}<br>
            <b>Confidence:</b> ${confidence.toFixed(2)}<br>
            <b>Status:</b> ${status}<br>
            <b>Time:</b> ${timestamp}<br>
            ${img ? `<img src="/static/detections/${img}" width="150">` : ''}
          `;
          L.marker([lat, lon]).addTo(map).bindPopup(popupHtml);
        }
      });
    }

    loadData();
    setInterval(loadData, 30000); // Auto refresh every 30 sec
  </script>
</body>
</html>
